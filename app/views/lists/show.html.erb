

<div class="container">
  <div class="row">
    <div class="col-md-4 col-md-offset-4 col-sm-12 bg-white">

      <%= render 'layouts/nav' %>

      <div>
        <h1 class="list-name log-in text-center"><%= @list.name %></h1>
        <hr>
        <div class="clearfix">
          <a href="#" class="js-next text-center form-control btn-main sign-up next-button" data-id="<%=@list.id%>">Next List</a>
        </div>
        <p class="task-list-text"><span class="bold-text">Due Date: </span><span class="float-right due-date"><%= @list.due_date.strftime("%B %d, %Y")%></span></p>
        <p class="task-list-text"><span class="border-bottom bold-text">Tasks</span><span class="task-list-tesk float-right border-bottom bold-text">Completed?</span></p>

        <div class="task-div">
        <% @list.tasks.each do |task| %>
          <ul>
            <li class="over-flow">

              <p class="task-name task-list-text display-inline"><%= task.name %></p>


              <div class="float-right">
                <p class="task-list-text display-inline"><%= check_box_tag 'completed?', 1, task.complete, disabled: true, id: "task_complete" %></p>
              </div>

              <div role="group" aria-label="...">
                <%= button_to "Edit", edit_list_task_path(@list,task), method: 'get', class: "button-small btn light-green"%>
                <%= button_to "Delete", list_task_path(@list,task), method: 'delete', class: "button-small btn"%>
              </div>

            </li>
          </ul>
        <% end %>
      </div>

      </div>

      <div class="new-task-div">
      </div>
      <div class="create-task">
      <h1 class="text-center log-in">Create Your Task</h1>

      </div>
        <a href="#" class="new-task text-center form-control btn-main margin-top-25" data-id="<%=@list.id%>">New Task</a>
    </div>
  </div>
</div>
<script type="text/javascript" charset="utf-8">

$(function () {
  token = '<%= form_authenticity_token %>';
  nextTaskList();
  newTaskShow(token);

});

function nextTaskList () {
  $(".js-next").on("click", function (event) {
    event.preventDefault();


    $(".new-task-div").html("")
    $(".create-task").html("")
    token = '<%= form_authenticity_token %>';
    newTaskShow(token);

    var getId = parseInt($(".js-next").attr("data-id"))

    var listIdChecker = <%= @listid %>

    var currentId=listIdChecker.indexOf(getId)

    var nextId = listIdChecker[currentId+1]

    if (listIdChecker.length - 1 === currentId ) {
      nextId = listIdChecker[0]
    }

    var setId = $(".js-next").attr("data-id", nextId)


    window.history.pushState('next', 'Title', '/lists/' + nextId);


    $.get("/lists/" + nextId + ".json", function(data) {


      var list = data;

      var date = list["due_date"]
      var name = list["name"]
      var listId = list["id"]
      var tasks = list["tasks"]

      var newList = new List(name, date, listId)

      $(".list-name").text(newList.name)
      $(".due-date").text(newList.date())

      $(".js-next").attr("data-id", newList.id);

      getTaskInfo(tasks, newList);

    })
    .fail(function(){

      alert("sorry")
    })

  });
}

function getTaskInfo (tasks, list) {
   $(".task-div").html("");

  token = '<%= form_authenticity_token %>';

  for (i = 0; i < tasks.length; i++){

    var newTask = new Task(tasks[i].name, tasks[i].complete, tasks[i].id)

    $(".task-div").append(appendNewTask (newTask, list.id, token))

  }

}

function newTask () {
  $('form.task-form').submit(function(event) {

    event.preventDefault();

    var values = $(this).serialize();
    currentUrlId = window.location.pathname
    var posting = $.post(currentUrlId + '/tasks', values);

    posting.done(function(data){
      token = '<%= form_authenticity_token %>';

      $(".create-task").hide(1000)

      var myTask = data;

      var newTasks = new Task(myTask.name, myTask.complete, myTask.id)

      $(".new-task-div").append(appendNewTask (newTasks, myTask.list.id, token ))
    })


  })
}


</script>
