

<div class="container">
  <div class="row">
    <div class="col-md-4 col-md-offset-4 col-sm-12 bg-white">

      <%= render 'layouts/nav' %>

      <div>
        <h1 class="list-name log-in text-center"><%= @list.name %></h1>
        <hr>
        <div class="clearfix">
          <a href="#" class="js-next text-center form-control btn-main sign-up next-button" data-id="<%=@list.id%>">Next List</a>
        </div>
        <p class="task-list-text"><span class="bold-text">Due Date: </span><span class="float-right due-date"><%= @list.due_date.strftime("%B %d, %Y")%></span></p>
        <p class="task-list-text"><span class="border-bottom bold-text">Tasks</span><span class="task-list-tesk float-right border-bottom bold-text">Completed?</span></p>

        <div class="task-div">
        <% @list.tasks.each do |task| %>
          <ul>
            <li class="over-flow">

              <p class="task-name task-list-text display-inline"><%= task.name %></p>


              <div class="float-right">
                <p class="task-list-text display-inline"><%= check_box_tag 'completed?', 1, task.complete, disabled: true, id: "task_complete" %></p>
              </div>

              <div role="group" aria-label="...">
                <%= button_to "Edit", edit_list_task_path(@list,task), method: 'get', class: "button-small btn light-green"%>
                <%= button_to "Delete", list_task_path(@list,task), method: 'delete', class: "button-small btn"%>
              </div>

            </li>
          </ul>
        <% end %>
      </div>

      </div>

      <div class="new-task-div">
      </div>
      <div class="create-task">
      <h1 class="text-center log-in">Create Your Task</h1>
      <%= render 'tasks/form' %>
      </div>
        <a href="#" class="new-task text-center form-control btn-main margin-top-25" data-id="<%=@list.id%>">New Task</a>
    </div>
  </div>
</div>
<script type="text/javascript" charset="utf-8">

$(function () {
  token = '<%= form_authenticity_token %>';
  nextTaskList();
  newTaskShow(token);
  newTask();
});

function nextTaskList () {
  $(".js-next").on("click", function (event) {

    var getId = parseInt($(".js-next").attr("data-id"))


    var listIdChecker = <%= @listid %>

    var currentId=listIdChecker.indexOf(getId)

    var nextId = listIdChecker[currentId+1]

    if (listIdChecker.length - 1 === currentId ) {
      nextId = listIdChecker[0]
    }

    var setId = $(".js-next").attr("data-id", nextId)


    $(".task-div").html("");


    window.history.pushState('page2', 'Title', '/lists/' + nextId);

    $.get("/lists/" + nextId + ".json", function(data) {
      var list = data;
      console.log(data)
      var date = list["due_date"]
      var tasks = list["tasks"]
      $(".list-name").text(list["name"])
      $(".due-date").text(dateParser(date))
      $(".js-next").attr("data-id", list["id"]);
      getTaskInfo(tasks, list);
    })
    .fail(function(){

      alert("sorry")
    })
    event.preventDefault();
  });
}

function getTaskInfo (tasks, list) {

  token = '<%= form_authenticity_token %>';
  for (i = 0; i < tasks.length; i++){

    $(".task-div").append("<ul><li class='over-flow'><p class='task-name task-list-text display-inline'>" + tasks[i].name + "</p>" + completeButton(tasks[i]) + "<div role='group' aria-label='...'>" +  editButton(list.id,tasks[i].id)  + deleteButton(list.id,tasks[i].id, token) + "</div></li></ul>")

  }

}

function newTask () {
  $('form.task-form').submit(function(event) {
    event.preventDefault();
    token = '<%= form_authenticity_token %>';

    var values = $(this).serialize();
    var posting = $.post('/lists/17/tasks', values);

    posting.done(function(data,token){

      $(".create-task").hide(1000);
      var task = data;



      $(".new-task-div").append("<ul><li class='over-flow'><p class='task-name task-list-text display-inline'>" + task.name + "</p>" + completeButton(task) + "<div role='group' aria-label='...'>" +  editButton(task.list.id, task.id) + deleteButton(task.list.id, task.id, token) + "</div></li></ul>")


    })


  })
}


</script>
